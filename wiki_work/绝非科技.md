#生产流程

##数据量产
1. 减少人工，提高功效

### 当前工艺流程

前置项是外业分任务已经采集回数据了（外业数据包括GPS、imu、img、可能Lidar）

如下是一趟纯粹的数据生产流程考虑：

| 序号 | 主体        | 操作                   | 当前状态         | 思路                           |
| :-   | :-          | :-                     | :-               | :-                             |
| 1    | 机器+人工？ | GPS轨迹去重            | 已有自动脚本     | 不用分幅进行，建立空间索引解决 |
| 2    | 机器        | 拆分、下发任务         | 传统分幅方式进行 | 道路特征进行拆分               |
| 3    | 机器+人工   | 标注图片并关注拟合结果 |                  |                                |
| 4    | 机器+人工？ | 任务合并               | 接边             |                                |
| 5    | 机器+人工   | 自动产生结果，人核对   |                  | 拓扑悬挂点检查                 |
| 6    | 入库        | 新增、更新             |                  |                                |

尚未考虑更新库里已有文件

1. step1 ...   GPS轨迹去重,不用分幅进行去重  *当前已经有自动处理的脚本*  
2. 关键点：拆分规则和可以借助的内容，下发使用领取还是分发的方式放到后考虑
3. 标注图片关心拟合结果的必要性和成本（是否可以拆分为两个步骤），系统对拟合输入数据的检查造成的系统不稳定
4. 任务合并：图形和属性的合并，使用属性方式合并或者空间属性合并
5. 对图片标注结果进行拟合（成线）现在由于读数据的一些原因造成系统平台不稳定
6. 量产结果的质量保证可以引入悬挂点质检，交点质检



[](其他问题：)
    ID继承：解决用于使用数据更新的问题（暂不考虑）
    图幅数据合并：对同一个图幅第一次作业和后几次作业现在的覆盖原则会造成前几次作业的数据丢失的问题，现在可以使用同一个图幅直接存储多个数据；
    
    
    
    轨迹匹配算法：Fréchet distance
    
    轨迹滤波：
        目标： - 过滤噪声和离散值 - 推断高等级变量-例如速度 
        技术： - 中值和均值滤波 - 卡尔曼滤波 - 粒子滤波
    
量产挑战：
1. 生产过程分幅不能串起来的情况如何解决？？？
2. 接边操作--自动接边的覆盖度如何？

### 工艺优化方案

### 数据更新（数据迭代）-- 迭代规模（使用多次测量数据进行迭代）
    1. 认定为同一份数据准则，例如：GPS或IMU容差范围内特征相同（车道数，标线类型等）
    2. 更新准则，GPS质量高的替换低的，GPS质量相同的对车道线和车道中线同时使用多次轨迹点拟合（是否需要去掉误差最大的数据属于细节）
    3. 基准数据没有和其他数据重叠迭代的部分，使用迭代产生边缘点进行推断更新（需要考虑数据更新蔓延）

最终结果保障：  
1. 引入悬挂点质检，关注非法悬挂点，可标记合法悬挂点


##名词解释
roi:可编辑区

##HD数据生产流程
 
外业（产出 GPS和双目图片） ==> 图像识别(针对每张图片生产格式为json的描述文件) ==> 清洗GPS（包括但不限于
去重） ==> 多次GPS数据融合配准(融合和配准规则？) ==> GPS轨迹点配合图像描述拟合为车道线(两种方式：)车道
线和车道的描述

###生辰车道线和车道中线的两种方式

思考：是否生成道路辅助线

#### 同时对多条车道线进行拟合
1. 通过GPS轨迹点串+图片描述产出如下两种内容：  
    1. 所有车道轨迹点串，每一个点需要描述车道线类别；
    2. 所有车道中线（虚拟线),每一点需要描述道路标牌，是否分叉等；
2. 分别对单独车道点串和车道线点串进行拟合（当前采用分幅就不用过多的考虑拟合过程中的点串的分段，如果不采用分幅的话对车道线可以在车道线属性变化地方进行打断，对车道辅助线在标识和分叉路口打断，当前模块中的Roi是一什么标准计算得到的？）
3. 维护车道线和车道辅助线的对应关系(车道辅助线可以找到车道线，是否需要通过车道线找到车道辅助线和其他相关的车道线)

优点：  
1. 真实世界的高度还原
2. 算法相对简单（仅需要在关键点截断，拟合，维护关系）

缺点：  
1. 因每个车道线都是独立生成的，最终数据关系需要关注（具体的输入有关），可能会有道路线交叉等情况（不确定）
2. 因为要处理的数据量的原因资源消耗比较大

#### 先生成一条车道线依据这条车道线生成其他车道线
1. GPS轨迹点串+图片描述阐述如下俩种内容：
    1. 最左（最右）车道线轨迹点串
    2. 所有车道线类别变化点拓扑信息，车道中线有标牌或分叉的拓扑点信息
    3. 车道线关键点拓扑和车道中线关键点拓扑到最左（最右）车道线轨迹点的对应关系
2. 用道路线关键拓扑点和车道线轨迹点串通过打断、拟合和平移的方式生成所有道路线；
3. 用道路中线关键拓扑点和车道轨迹点串通过打断、拟合和平移的方式生成道路中线
4. 维护车道中线和道路线的对应关系 (车道辅助线可以找到车道线，是否需要通过车道线找到车道辅助线和其他相关的车道线）

优点： 
1. 相对准确度、精度高，因为使用了参照物；

缺点：  
1. 处理复杂度高（取参照物、生成和简化拓扑、拟合、平移，维护关系）
2. 参考物的选取决定数据的质量



#车道线

ADAS+ 不包含车道

##当前的难点

##当前技术点

###识别
1. 道路边缘（车道数、应急车道）
2. 车道线优化（那些点需要优化）
3. 车道线颜色（有多种识别颜色，还是绘制的符号）
4. 角点（？？？）
5. 导流区（何为导流区）

###处理策略
1. 效果优化--（目前效果，优化目的，优化目标效果）
2. 产出参考线、中心线--（那些参考线；生产的输入是何物；产出物的技术规格和质量要求）
3. 支持分幅（自动接边）与更新-- 当前有那些过程是必须分幅进行解决的？出图和数据编译对分幅的不会有编辑和处理的操作所以暂时不用考虑这部分的分幅；
4. ID继承（本质问题是数据的像前兼容问题）
5. 提高作业效率--提高整体环节的效率，对道路的策略应该是策略相关；
6. 支持紧急停车区--紧急停车区的定义
7. 虚实线---是否是两条并行线一条为实一条为虚--增加定义？
8. 区分多线--？？？
9. 支持压盖等缺路挂接--？？
10. 支持人工编辑结果--不能保证100%的自动生产又不能容错的情况，择必须做人工编辑

#整体底层架构

来自王闯的问题

2. 作业流程与平台，涉及到，内业任务分配，作业与成果提交，质检等全流程环节：
1. 内业任务分配：
   1.1：轨迹任务生成图幅后通知内业leader分配任务；自动分配任务还是人工分配；（任务领取，自动下发，现阶段应使用人工分配）
   1.2：内业leader分配任务接口；
   1.3：作业员账号；
   1.4：图幅锁机制（作业员与作业员之间，作业员与跑任务系统之间）；
   1.5：图像分图幅下载；
   1.6：图像下载时间花费不能太长；（减少握手次数）
2. 作业与成果提交；
    2.1：怎么触发质检；（入库前必须质检）
    2.2：作业成果是分离的还是合并全库，怎么合并成全库；（合并为全库，分开对存储介质和使用放都有问题，如果是单一的业务场景就不用考虑了）
    2.3：作业成果版本管理；（数据规格版本还是数据的锁版本？）
    2.4：成果（包括质检）异常状态记录与跟进；（工作流上的所有环节？还是仅对成果）
    2.5：策略升级后成果变化？（同2.3）
3. 质检。
